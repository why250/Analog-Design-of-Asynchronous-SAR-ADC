# IdealSARADC ç±»æ€ç»´å¯¼å›¾

## ğŸ“Š ç±»ç»“æ„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    IdealSARADC ç±»                            â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  åˆå§‹åŒ–å‚æ•° (__init__)                                â”‚  â”‚
â”‚  â”‚  â€¢ resolution: åˆ†è¾¨ç‡ï¼ˆä½æ•°ï¼‰                          â”‚  â”‚
â”‚  â”‚  â€¢ vref_pos: æ­£å‚è€ƒç”µå‹                                â”‚  â”‚
â”‚  â”‚  â€¢ vref_neg: è´Ÿå‚è€ƒç”µå‹                                â”‚  â”‚
â”‚  â”‚  â€¢ vdd, vss: ç”µæºç”µå‹                                  â”‚  â”‚
â”‚  â”‚  â€¢ sample_rate_hz: é‡‡æ ·é¢‘ç‡ï¼ˆå¯é€‰ï¼‰                    â”‚  â”‚
â”‚  â”‚  â€¢ sar_bit_period_s: æ¯ä½æ¯”è¾ƒæ—¶é—´ï¼ˆå¯é€‰ï¼‰              â”‚  â”‚
â”‚  â”‚  â€¢ aperture_jitter_rms_s: å­”å¾„æŠ–åŠ¨RMSï¼ˆå¯é€‰ï¼‰          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  æ ¸å¿ƒè½¬æ¢æµç¨‹                                          â”‚  â”‚
â”‚  â”‚  convert() â†’ convert_array()                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  å†…éƒ¨åŠŸèƒ½æ¨¡å—                                          â”‚  â”‚
â”‚  â”‚  â€¢ é‡‡æ ·ä¿æŒ (_sample_and_hold)                          â”‚  â”‚
â”‚  â”‚  â€¢ SARè½¬æ¢ (_synchronous_conversion)                    â”‚  â”‚
â”‚  â”‚  â€¢ ç†æƒ³æ¯”è¾ƒå™¨ (_ideal_comparator)                       â”‚  â”‚
â”‚  â”‚  â€¢ ç†æƒ³DAC (_ideal_dac)                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  è¾…åŠ©åŠŸèƒ½                                              â”‚  â”‚
â”‚  â”‚  â€¢ digital_to_voltage()                                â”‚  â”‚
â”‚  â”‚  â€¢ voltage_to_digital()                                â”‚  â”‚
â”‚  â”‚  â€¢ get_info() / print_info()                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ æ–¹æ³•è°ƒç”¨æµç¨‹å›¾

### ä¸»è¦è½¬æ¢æµç¨‹

```
ç”¨æˆ·è°ƒç”¨
    â”‚
    â”œâ”€â†’ convert(vin) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                â”‚
    â”‚                                â”œâ”€â†’ _sample_and_hold(vin)
    â”‚                                â”‚   â””â”€â†’ é‡‡æ ·å¹¶ä¿æŒè¾“å…¥ç”µå‹
    â”‚                                â”‚
    â”‚                                â”œâ”€â†’ _synchronous_conversion(sampled)
    â”‚                                â”‚   â”‚
    â”‚                                â”‚   â”œâ”€â†’ å¾ªç¯ï¼šä»MSBåˆ°LSB
    â”‚                                â”‚   â”‚   â”‚
    â”‚                                â”‚   â”‚   â”œâ”€â†’ _ideal_dac(test_code)
    â”‚                                â”‚   â”‚   â”‚   â””â”€â†’ ç”Ÿæˆæµ‹è¯•ç”µå‹
    â”‚                                â”‚   â”‚   â”‚
    â”‚                                â”‚   â”‚   â””â”€â†’ _ideal_comparator(vin, vdac)
    â”‚                                â”‚   â”‚       â””â”€â†’ æ¯”è¾ƒå¹¶å†³å®šè¯¥ä½
    â”‚                                â”‚   â”‚
    â”‚                                â”‚   â””â”€â†’ è¿”å›æ•°å­—ç å’Œè½¬æ¢å†å²
    â”‚                                â”‚
    â”‚                                â””â”€â†’ è¿”å›æ•°å­—ç ï¼ˆæˆ–åŒ…å«å†å²è®°å½•ï¼‰
    â”‚
    â””â”€â†’ convert_array(voltages) â”€â”€â”€â”€â”
                                    â”‚
                                    â””â”€â†’ å¾ªç¯è°ƒç”¨ convert() å¤„ç†æ¯ä¸ªç”µå‹
                                        â””â”€â†’ è¿”å›æ•°å­—ç æ•°ç»„
```

---

## ğŸ“‹ æ–¹æ³•åˆ†ç±»ä¸åŠŸèƒ½è¯´æ˜

### 1ï¸âƒ£ åˆå§‹åŒ–æ–¹æ³•

```
__init__(resolution, vref_pos, vref_neg, vdd, vss)
â”‚
â”œâ”€ å‚æ•°éªŒè¯
â”‚   â”œâ”€ resolution > 0
â”‚   â””â”€ vref_pos > vref_neg
â”‚
â”œâ”€ å­˜å‚¨å‚æ•°
â”‚   â”œâ”€ self.resolution
â”‚   â”œâ”€ self.vref_pos / self.vref_neg
â”‚   â”œâ”€ self.vref_range = vref_pos - vref_neg
â”‚   â”œâ”€ self.lsb = vref_range / (2^resolution)
â”‚   â””â”€ self.vdd / self.vss
â”‚
â””â”€ åˆå§‹åŒ–å†…éƒ¨çŠ¶æ€
    â”œâ”€ self._sampled_voltage = None
    â””â”€ self._conversion_history = []
```

**ä½œç”¨**: åˆ›å»ºADCå®ä¾‹ï¼Œè®¾ç½®åŸºæœ¬å‚æ•°å’Œè®¡ç®—LSBå€¼

---

### 2ï¸âƒ£ æ ¸å¿ƒè½¬æ¢æ–¹æ³•ï¼ˆç”¨æˆ·æ¥å£ï¼‰

#### `convert(vin, return_history=False)`
```
è¾“å…¥: å•ä¸ªæ¨¡æ‹Ÿç”µå‹ vin
â”‚
â”œâ”€ æ­¥éª¤1: é‡‡æ ·ä¿æŒ
â”‚   â””â”€â†’ _sample_and_hold(vin)
â”‚       â””â”€â†’ è¿”å›é‡‡æ ·åçš„ç”µå‹
â”‚
â”œâ”€ æ­¥éª¤2: SARè½¬æ¢
â”‚   â””â”€â†’ _synchronous_conversion(sampled)
â”‚       â””â”€â†’ æ‰§è¡Œé€æ¬¡é€¼è¿‘ç®—æ³•
â”‚
â””â”€ è¾“å‡º: 
    â”œâ”€ return_history=False â†’ æ•°å­—ç  (int)
    â””â”€ return_history=True  â†’ (æ•°å­—ç , è½¬æ¢å†å²) (tuple)
    å¤‡æ³¨: å¯é€‰å‚æ•° t0ï¼ˆèµ·å§‹æ—¶é—´æˆ³ï¼‰, dVdtï¼ˆé‡‡æ ·æ—¶åˆ»è¾“å…¥ä¸€é˜¶æ–œç‡ï¼‰
```

**ä½œç”¨**: æ‰§è¡Œä¸€æ¬¡å®Œæ•´çš„ADCè½¬æ¢

---

#### `convert_array(voltages, return_history=False)`
```
è¾“å…¥: ç”µå‹æ•°ç»„ voltages (np.ndarray)
â”‚
â”œâ”€ å¾ªç¯å¤„ç†æ¯ä¸ªç”µå‹
â”‚   â””â”€â†’ å¯¹æ¯ä¸ª vin è°ƒç”¨ convert(vin)
â”‚
â””â”€ è¾“å‡º:
    â”œâ”€ return_history=False â†’ æ•°å­—ç æ•°ç»„ (np.ndarray)
    â””â”€ return_history=True  â†’ (æ•°å­—ç æ•°ç»„, å†å²è®°å½•åˆ—è¡¨) (tuple)
```

**ä½œç”¨**: æ‰¹é‡è½¬æ¢å¤šä¸ªç”µå‹å€¼

---

### 3ï¸âƒ£ å†…éƒ¨åŠŸèƒ½æ¨¡å—ï¼ˆç§æœ‰æ–¹æ³•ï¼‰

#### `_sample_and_hold(vin)`
```
è¾“å…¥: è¾“å…¥ç”µå‹ vin
â”‚
â””â”€ è¾“å‡º: é‡‡æ ·ä¿æŒåçš„ç”µå‹
    â””â”€ ç†æƒ³æƒ…å†µï¼šç›´æ¥è¿”å› vinï¼ˆæ— å¤±çœŸï¼‰
```

**ä½œç”¨**: æ¨¡æ‹Ÿé‡‡æ ·ä¿æŒç”µè·¯ï¼Œæ•è·å¹¶ä¿æŒè¾“å…¥ç”µå‹

**è°ƒç”¨ä½ç½®**: `convert()` æ–¹æ³•ä¸­

---

#### `_synchronous_conversion(vin, t_bits=None, t_sample=None)`
```
è¾“å…¥: é‡‡æ ·åçš„ç”µå‹ vin
â”‚
â”œâ”€ æ­¥éª¤1: é™åˆ¶ç”µå‹èŒƒå›´
â”‚   â””â”€â†’ vin_clamped = clip(vin, vref_neg, vref_pos)
â”‚
â”œâ”€ æ­¥éª¤2: åˆå§‹åŒ–
â”‚   â”œâ”€ digital_code = 0
â”‚   â””â”€ conversion_history = []
â”‚
â”œâ”€ æ­¥éª¤3: é€æ¬¡é€¼è¿‘å¾ªç¯ï¼ˆä»MSBåˆ°LSBï¼‰
â”‚   â”‚
â”‚   â”œâ”€ å¯¹æ¯ä¸€ä½ bit_pos (resolution-1 â†’ 0):
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€ è®¾ç½®æµ‹è¯•ç 
â”‚   â”‚   â”‚   â””â”€â†’ test_code = digital_code | (1 << bit_pos)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€ ç”ŸæˆDACæµ‹è¯•ç”µå‹
â”‚   â”‚   â”‚   â””â”€â†’ _ideal_dac(test_code)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€ æ¯”è¾ƒå™¨æ¯”è¾ƒ
â”‚   â”‚   â”‚   â””â”€â†’ _ideal_comparator(vin_clamped, vdac)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€ æ ¹æ®æ¯”è¾ƒç»“æœæ›´æ–°æ•°å­—ç 
â”‚   â”‚   â”‚   â””â”€â†’ if comp_result: digital_code = test_code
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€ è®°å½•è½¬æ¢å†å²ï¼ˆå«å¯é€‰æ—¶é—´æˆ³ï¼‰
â”‚   â”‚
â”‚   â””â”€ å¾ªç¯ç»“æŸ
â”‚
â””â”€ è¾“å‡º: (digital_code, conversion_history)
   conversion_history æ¯æ­¥å­—æ®µï¼ˆè‹¥é…ç½®æ—¶é’Ÿï¼‰:
   â€¢ bit, test_code, vdac, comparator_result, final_code
   â€¢ t_sample_s: æœ¬æ¬¡é‡‡æ ·æ—¶é—´æˆ³
   â€¢ t_bit_s: å½“å‰ä½æ¯”è¾ƒæ—¶é—´æˆ³
```

**ä½œç”¨**: æ‰§è¡ŒSARé€æ¬¡é€¼è¿‘è½¬æ¢ç®—æ³•

**è°ƒç”¨ä½ç½®**: `convert()` æ–¹æ³•ä¸­

**å…³é”®é€»è¾‘**:
- ä»æœ€é«˜ä½ï¼ˆMSBï¼‰å¼€å§‹ï¼Œé€ä½ç¡®å®š
- æ¯æ¬¡æµ‹è¯•ï¼šè®¾ç½®å½“å‰ä½ä¸º1ï¼Œé€šè¿‡DACç”Ÿæˆå¯¹åº”ç”µå‹
- æ¯”è¾ƒå™¨æ¯”è¾ƒè¾“å…¥å’ŒDACè¾“å‡º
- å¦‚æœè¾“å…¥ > DACè¾“å‡ºï¼Œä¿ç•™è¯¥ä½ä¸º1ï¼›å¦åˆ™ä¿æŒä¸º0

---

#### `_ideal_comparator(vin, vdac)`
```
è¾“å…¥:
â”œâ”€ vin: è¾“å…¥ç”µå‹
â””â”€ vdac: DACè¾“å‡ºç”µå‹

å¤„ç†:
â””â”€â†’ return vin > vdac

è¾“å‡º: bool
    â”œâ”€ True:  vin > vdac
    â””â”€ False: vin <= vdac
```

**ä½œç”¨**: æ¨¡æ‹Ÿç†æƒ³æ¯”è¾ƒå™¨ï¼Œæ¯”è¾ƒä¸¤ä¸ªç”µå‹

**è°ƒç”¨ä½ç½®**: `_synchronous_conversion()` æ–¹æ³•ä¸­

---

#### `_ideal_dac(digital_code)`
```
è¾“å…¥: æ•°å­—ç  digital_code (int)

å¤„ç†:
â””â”€â†’ voltage = vref_neg + (digital_code / 2^N) * vref_range

è¾“å‡º: å¯¹åº”çš„æ¨¡æ‹Ÿç”µå‹å€¼ (float)
```

**å…¬å¼**: `Vout = Vref_neg + (code / 2^N) Ã— (Vref_pos - Vref_neg)`

**ä½œç”¨**: å°†æ•°å­—ç è½¬æ¢ä¸ºå¯¹åº”çš„æ¨¡æ‹Ÿç”µå‹

**è°ƒç”¨ä½ç½®**: `_synchronous_conversion()` æ–¹æ³•ä¸­

---

### 4ï¸âƒ£ è¾…åŠ©æ–¹æ³•ï¼ˆå·¥å…·å‡½æ•°ï¼‰

#### `digital_to_voltage(digital_code)`
```
è¾“å…¥: æ•°å­—ç  digital_code
â”‚
â””â”€â†’ è°ƒç”¨ _ideal_dac(digital_code)
    â””â”€â†’ è¿”å›å¯¹åº”çš„æ¨¡æ‹Ÿç”µå‹
```

**ä½œç”¨**: å°†æ•°å­—ç è½¬æ¢ä¸ºæ¨¡æ‹Ÿç”µå‹ï¼ˆå…¬å¼€æ¥å£ï¼‰

---

#### `voltage_to_digital(voltage)`
```
è¾“å…¥: æ¨¡æ‹Ÿç”µå‹ voltage
â”‚
â”œâ”€ é™åˆ¶ç”µå‹èŒƒå›´
â”‚   â””â”€â†’ voltage_clamped = clip(voltage, vref_neg, vref_pos)
â”‚
â”œâ”€ ç†æƒ³é‡åŒ–è®¡ç®—
â”‚   â””â”€â†’ code = round((voltage - vref_neg) / vref_range Ã— (2^N - 1))
â”‚
â””â”€ è¾“å‡º: æ•°å­—ç  (int)
```

**ä½œç”¨**: å°†æ¨¡æ‹Ÿç”µå‹è½¬æ¢ä¸ºæ•°å­—ç ï¼ˆç†æƒ³é‡åŒ–ï¼ŒéSARè½¬æ¢ï¼‰

---

#### `get_info()` / `print_info()`
```
get_info()
â””â”€â†’ è¿”å›åŒ…å«æ‰€æœ‰å‚æ•°çš„å­—å…¸

print_info()
â””â”€â†’ æ‰“å°æ ¼å¼åŒ–çš„å‚æ•°ä¿¡æ¯
```

**ä½œç”¨**: è·å–æˆ–æ˜¾ç¤ºADCé…ç½®ä¿¡æ¯

---

## ğŸ¯ å®Œæ•´è½¬æ¢æµç¨‹ç¤ºä¾‹

### ç¤ºä¾‹ï¼š8ä½ADCï¼Œè¾“å…¥0.5V

```
1. ç”¨æˆ·è°ƒç”¨
   adc.convert(0.5)

2. convert(0.5, t0=0.0, dVdt=è¾“å…¥åœ¨ t0 å¤„çš„æ–œç‡)
   â”‚
   â”œâ”€â†’ _compute_timing(t0)  â†’ ç”Ÿæˆ t_sample, t_bitsï¼ˆè‹¥å¯ç”¨æ—¶é’Ÿï¼‰
   â”‚
   â”œâ”€â†’ _sample_and_hold(0.5)
   â”‚   â””â”€â†’ è‹¥é…ç½® aperture_jitter_rms_s ä¸”æä¾› dVdt:
   â”‚         è¿›è¡Œ Î”V â‰ˆ dVdt Â· Î”t çš„é‡‡æ ·ç­‰æ•ˆä¿®æ­£
   â”‚
   â””â”€â†’ _synchronous_conversion(0.5)
       â”‚
       â”œâ”€ vin_clamped = 0.5
       â”œâ”€ digital_code = 0
       â”‚
       â””â”€ é€æ¬¡é€¼è¿‘å¾ªç¯ï¼ˆ8æ¬¡è¿­ä»£ï¼‰:
           â”‚
           â”œâ”€ ä½7 (MSB):
           â”‚   â”œâ”€ test_code = 0 | (1<<7) = 128
           â”‚   â”œâ”€ vdac = _ideal_dac(128) = 0.5V
           â”‚   â”œâ”€ comp = _ideal_comparator(0.5, 0.5) = False
           â”‚   â””â”€ digital_code = 0 (ä¿æŒ0)
           â”‚
           â”œâ”€ ä½6:
           â”‚   â”œâ”€ test_code = 0 | (1<<6) = 64
           â”‚   â”œâ”€ vdac = _ideal_dac(64) = 0.25V
           â”‚   â”œâ”€ comp = _ideal_comparator(0.5, 0.25) = True
           â”‚   â””â”€ digital_code = 64 (è®¾ç½®ä¸º64)
           â”‚
           â”œâ”€ ä½5:
           â”‚   â”œâ”€ test_code = 64 | (1<<5) = 96
           â”‚   â”œâ”€ vdac = _ideal_dac(96) = 0.375V
           â”‚   â”œâ”€ comp = _ideal_comparator(0.5, 0.375) = True
           â”‚   â””â”€ digital_code = 96 (è®¾ç½®ä¸º96)
           â”‚
           â”œâ”€ ... (ç»§ç»­ä½4, 3, 2, 1, 0)
           â”‚
           â””â”€ æœ€ç»ˆ: digital_code = 127
               â””â”€â†’ è¿”å› 127ï¼Œå¹¶åœ¨ history ä¸­åŒ…å« t_sample_s / t_bit_s
```

---

## ğŸ“ æ•°æ®æµå‘å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¾“å…¥ç”µå‹   â”‚
â”‚   vin (V)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ _sample_and_holdâ”‚  â† é‡‡æ ·ä¿æŒ
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ sampled_voltage
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚_synchronous_conversionâ”‚
â”‚                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ é€æ¬¡é€¼è¿‘å¾ªç¯    â”‚  â”‚
â”‚  â”‚ (MSB â†’ LSB)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚            â”‚
â”‚         â–¼            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ _ideal_dac    â”‚   â”‚  â† ç”Ÿæˆæµ‹è¯•ç”µå‹
â”‚  â”‚ (test_code)   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚ vdac      â”‚
â”‚         â–¼           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚_ideal_comparatorâ”‚  â† æ¯”è¾ƒ
â”‚  â”‚ (vin, vdac)  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚ result    â”‚
â”‚         â–¼           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æ›´æ–°digital_codeâ”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚            â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚          â”‚
               â–¼          â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚æ•°å­—ç      â”‚  â”‚è½¬æ¢å†å²   â”‚
        â”‚(int)     â”‚  â”‚(list)    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”‘ å…³é”®æ¦‚å¿µè®°å¿†ç‚¹

### 1. SARç®—æ³•æ ¸å¿ƒæ€æƒ³
```
äºŒè¿›åˆ¶æœç´¢ï¼šä»MSBåˆ°LSBï¼Œé€ä½ç¡®å®š
æ¯æ¬¡æµ‹è¯•ï¼šè®¾ç½®å½“å‰ä½ä¸º1ï¼Œæ¯”è¾ƒï¼Œå†³å®šä¿ç•™æˆ–ä¸¢å¼ƒ
```

### 2. æ–¹æ³•å‘½åè§„åˆ™
```
å…¬å¼€æ–¹æ³•ï¼ˆç”¨æˆ·æ¥å£ï¼‰:
â”œâ”€ convert()           - å•æ¬¡è½¬æ¢
â”œâ”€ convert_array()     - æ‰¹é‡è½¬æ¢
â”œâ”€ digital_to_voltage() - ç è½¬ç”µå‹
â””â”€ voltage_to_digital() - ç”µå‹è½¬ç 

ç§æœ‰æ–¹æ³•ï¼ˆå†…éƒ¨å®ç°ï¼‰:
â”œâ”€ _sample_and_hold()      - é‡‡æ ·ä¿æŒ
â”œâ”€ _synchronous_conversion() - SARè½¬æ¢
â”œâ”€ _ideal_comparator()    - æ¯”è¾ƒå™¨
â””â”€ _ideal_dac()           - DAC
```

### 3. è°ƒç”¨é¡ºåº
```
convert()
  â”œâ”€â†’ _sample_and_hold()
  â””â”€â†’ _synchronous_conversion()
        â”œâ”€â†’ _ideal_dac() (å¾ªç¯è°ƒç”¨)
        â””â”€â†’ _ideal_comparator() (å¾ªç¯è°ƒç”¨)
```
å¯ç”¨æ—¶é’Ÿ/æŠ–åŠ¨æ—¶ï¼Œconvert() ä¹‹å‰è¿˜ä¼šï¼š
```
convert(t0, dVdt)
  â”œâ”€â†’ _compute_timing(t0)  # ç”Ÿæˆ t_sample ä¸ t_bits
  â”œâ”€â†’ _sample_and_hold() + å­”å¾„æŠ–åŠ¨ç”µå‹ä¿®æ­£ (è‹¥ dVdt æä¾›)
  â””â”€â†’ _synchronous_conversion(..., t_bits, t_sample)
```

### 4. é‡è¦å…¬å¼
```
LSB = (Vref_pos - Vref_neg) / 2^N

DACè¾“å‡º: Vout = Vref_neg + (code / 2^N) Ã— (Vref_pos - Vref_neg)

ç†æƒ³é‡åŒ–: code = round((Vin - Vref_neg) / (Vref_pos - Vref_neg) Ã— (2^N - 1))

é‡‡æ ·å­”å¾„æŠ–åŠ¨ç­‰æ•ˆç”µå‹: Î”V â‰ˆ (dV/dt) Â· Î”t
æŠ–åŠ¨ç”Ÿæˆ: Î”t ~ N(0, aperture_jitter_rms_s)
```

---

## ğŸ“š å¿«é€Ÿå‚è€ƒè¡¨

| æ–¹æ³•å | ç±»å‹ | è¾“å…¥ | è¾“å‡º | ä¸»è¦ä½œç”¨ |
|--------|------|------|------|----------|
| `__init__` | æ„é€  | å‚æ•° | None | åˆå§‹åŒ–ADC |
| `convert` | å…¬å¼€ | vin | code | å•æ¬¡è½¬æ¢ |
| `convert_array` | å…¬å¼€ | voltages | codes | æ‰¹é‡è½¬æ¢ |
| `_sample_and_hold` | ç§æœ‰ | vin | sampled | é‡‡æ ·ä¿æŒ |
| `_synchronous_conversion` | ç§æœ‰ | vin | (code, history) | SARè½¬æ¢ |
| `_ideal_comparator` | ç§æœ‰ | vin, vdac | bool | æ¯”è¾ƒå™¨ |
| `_ideal_dac` | ç§æœ‰ | code | voltage | DACè½¬æ¢ |
| `digital_to_voltage` | å…¬å¼€ | code | voltage | ç è½¬ç”µå‹ |
| `voltage_to_digital` | å…¬å¼€ | voltage | code | ç”µå‹è½¬ç  |
| `get_info` | å…¬å¼€ | None | dict | è·å–ä¿¡æ¯ |
| `print_info` | å…¬å¼€ | None | None | æ‰“å°ä¿¡æ¯ |

---

## ğŸ¨ å¯è§†åŒ–è®°å¿†æŠ€å·§

### è®°å¿†å£è¯€
```
SARè½¬æ¢ä¸‰æ­¥èµ°ï¼š
1. é‡‡æ ·ä¿æŒï¼ˆSample & Holdï¼‰
2. é€æ¬¡é€¼è¿‘ï¼ˆSuccessive Approximationï¼‰
3. è¾“å‡ºæ•°å­—ç ï¼ˆDigital Codeï¼‰

é€æ¬¡é€¼è¿‘å››æ­¥å¾ªç¯ï¼š
1. è®¾ç½®æµ‹è¯•ä½ï¼ˆSet Test Bitï¼‰
2. DACç”Ÿæˆç”µå‹ï¼ˆGenerate Voltageï¼‰
